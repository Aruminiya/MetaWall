import{_ as p,m as u,q as h,b as d,e as t,y as g,A as _,t as l,x as f,g as x,k as b,o as m,p as y,h as v}from"./index-whPr3vNV.js";import{p as F,S as n}from"./postsStore-EsgWh2CI.js";const M={data(){return{content:"",image:"",selectedFile:null,errorMessage:""}},methods:{...u(F,["toPost","getPosts"]),upLoadimage(s){const e=s.target.files[0];e&&(this.selectedFile=e,this.image=URL.createObjectURL(e))},async submitPost(){if(!this.content){this.errorMessage="請輸入貼文內容";return}const s={tags:[],type:"",image:this.image,content:this.content,user:JSON.parse(h.get("MetaWall_user"))._id};if(this.selectedFile){this.errText="";try{const e=new FormData;e.append("image",this.selectedFile);const r=await this.axios.post("https://metawall-backend-ldzc.onrender.com/upload/file",e,{headers:{"Content-Type":"multipart/form-data"}});s.image=r.data.fileUrl}catch(e){e.response.data.message==="File too large"?n.fire({icon:"error",title:"圖片檔案過大",text:"文件大小上限為 2 MB"}):n.fire({icon:"error",title:"發生錯誤請重新嘗試"});return}}try{this.errText="",await this.toPost(s),n.fire({icon:"success",title:"貼文上傳成功"}).then(()=>{this.resetForm(),this.getPosts().then(()=>{this.$router.push("/community/postArea")})})}catch{n.fire({icon:"error",title:"貼文上傳失敗",text:"請重新嘗試"})}},resetForm(){this.content="",this.image="",this.selectedFile=null}}},a=s=>(y("data-v-d5da9db6"),s=s(),v(),s),P=a(()=>t("section",{class:"title position-relative d-flex justify-content-center align-items-center mb-5"},[t("h3",null,"張貼動態")],-1)),S={class:"createPost p-5"},w={class:"content"},C=a(()=>t("label",{for:"content"},"貼文內容",-1)),L=a(()=>t("br",null,null,-1)),k={class:"errorMessage text-center"},B={class:"image mt-1"},D=a(()=>t("label",{for:"upLoadimage",class:"upLoadimage my-3 px-4 py-1"},"上傳圖片",-1)),T={key:0,class:"imgContainer mx-1"},I=["src"],N={class:"d-flex flex-column justify-content-center align-items-center"};function U(s,e,r,V,o,c){return m(),d(b,null,[P,t("section",null,[t("div",S,[t("div",w,[C,L,g(t("textarea",{name:"content",id:"content","onUpdate:modelValue":e[0]||(e[0]=i=>o.content=i)},null,512),[[_,o.content]])]),t("p",k,l(o.errorMessage),1),t("div",B,[D,t("input",{id:"upLoadimage",class:"d-none",type:"file",onChange:e[1]||(e[1]=i=>c.upLoadimage(i))},null,32)]),o.image!==""?(m(),d("div",T,[t("img",{src:o.image,alt:"photo"},null,8,I)])):f("",!0),t("div",N,[t("button",{type:"button",class:"createPostBtn btn MetaWall_button btnShdow my-4 px-4",onClick:e[2]||(e[2]=(...i)=>c.submitPost&&c.submitPost(...i))},"送出貼文")])]),x(" "+l(o.content)+" "+l(o.image),1)])],64)}const O=p(M,[["render",U],["__scopeId","data-v-d5da9db6"]]);export{O as default};
