import{B as L,C as y,_ as D,q as I,s as u,m as _,b as n,y as b,D as O,e,A as U,x,k as p,v as C,u as W,o as r,f as A,w as T,t as c,g as K,r as N,p as V,h as $}from"./index-kcKp1YGI.js";import{p as P}from"./postsStore-sSxCOlG3.js";import{l as S}from"./likesStore-B1K6OqES.js";const B=L("commentsStore",{state:()=>({comments:[],errMessage:{}}),actions:{async getComments(o=void 0){try{const t=await y.get(o?`https://metawall-backend-ldzc.onrender.com/comments?content=${o}`:"https://metawall-backend-ldzc.onrender.com/comments");this.comments=t}catch(t){this.errMessage=t}},async postComments(o){try{return await y.post("https://metawall-backend-ldzc.onrender.com/comments",o)}catch(t){return this.errMessage=t,console.log(t),t}}}}),H={data(){return{searchKeyWord:"",filterOption:"newToOld",currentUserData:JSON.parse(I.get("MetaWall_user")),selectUserId:""}},computed:{...u(P,["posts"]),...u(W,["currentUser"]),...u(S,["likes"]),likesPostId(){var o,t,l;return(l=(t=(o=this.likes)==null?void 0:o.data)==null?void 0:t.data[0])==null?void 0:l.post._id}},methods:{..._(P,["getPosts","patchPosts"]),..._(B,["postComments"]),..._(S,["getLikes","postLike","deliteLike"]),isLikeHaveMe(o,t){return o.likes.some(l=>l.user._id===t)},async commentSubmit(o,t){const d={content:this.$refs.comment[t].value,user:this.currentUserData._id,post:o._id};this.postComments(d).then(()=>{this.$refs.comment[t].value="";const{likePostId:i}=this.$route.params;this.getPosts(this.$route.params.id,this.searchKeyWord,this.filterOption,i)})},async likeSubmit(o,t){if(this.isLikeHaveMe(o,t)){const l=o.likes.filter(d=>d.user._id===t);this.deliteLike(l[0]._id).then(()=>{const{likePostId:d}=this.$route.params;this.getPosts(this.$route.params.id,this.searchKeyWord,this.filterOption,d)})}else this.postLike(o._id,t).then(()=>{const{likePostId:l}=this.$route.params;this.getPosts(this.$route.params.id,this.searchKeyWord,this.filterOption,l)})}},created(){this.getPosts(void 0,void 0,void 0,this.$route.params.likePostId)}},m=o=>(V("data-v-74c4284d"),o=o(),$(),o),z={key:0,class:"userControl d-flex"},q=m(()=>e("option",{value:"newToOld",selected:""},"最新貼文",-1)),E=m(()=>e("option",{value:"oldToNew"},"最舊貼文",-1)),F=m(()=>e("option",{value:"mostLikes"},"最多讚數",-1)),J=m(()=>e("option",{value:"leastLikes"},"最少讚數",-1)),j=[q,E,F,J],G={class:"input-group"},Q=m(()=>e("i",{class:"bi bi-search"},null,-1)),R=[Q],X={class:"user d-flex align-items-center"},Y={class:"imgContainer mx-1",style:{width:"45px",height:"45px"}},Z=["src"],ee={class:"userName"},te={class:"m-0"},se={class:"date"},oe={class:"content my-3"},ie={key:0,class:"postImg my-3"},ne=["src"],re={class:"like my-3 d-flex align-items-center"},ae=["onClick"],le={key:0,class:"bi bi-hand-thumbs-up-fill"},ce={key:1,class:"bi bi-hand-thumbs-up"},de={key:0,class:"mb-0 ms-1"},me={key:1,class:"mb-0 ms-1"},he={key:2,class:"mb-0 ms-1"},ue={key:3,class:"mb-0 ms-1"},_e={class:"toMessage d-flex align-items-center my-3"},pe={class:"imgContainer mx-1"},ke=["src"],ve={class:"input-group"},ge=["onClick"],fe={class:"posted position-relative my-3 p-3"},ye={class:"user content d-flex align-comments-center"},be={class:"imgContainer mx-1"},xe=["src"],Ce={class:"userName mb-1"},Pe=m(()=>e("br",null,null,-1)),Se={class:"date"},we={class:"position-relative",style:{left:"46px"}};function Me(o,t,l,d,i,h){var k,v;const w=N("router-link");return r(),n(p,null,[this.$route.params.likePostId?x("",!0):(r(),n("section",z,[b(e("select",{class:"form-select flex-grow-2 custom-select me-3",name:"filter","onUpdate:modelValue":t[0]||(t[0]=s=>i.filterOption=s),onChange:t[1]||(t[1]=s=>this.getPosts(this.$route.params.id,i.searchKeyWord,i.filterOption))},j,544),[[O,i.filterOption]]),e("div",G,[b(e("input",{type:"text",class:"form-control h-100",placeholder:"搜尋貼文","onUpdate:modelValue":t[2]||(t[2]=s=>i.searchKeyWord=s)},null,512),[[U,i.searchKeyWord]]),e("button",{class:"btn btn-secondary MetaWall_button",type:"button",onClick:t[3]||(t[3]=s=>{this.getPosts(this.$route.params.id,i.searchKeyWord,i.filterOption)})},R)])])),(r(!0),n(p,null,C((v=(k=o.posts)==null?void 0:k.data)==null?void 0:v.data,(s,M)=>(r(),n("section",{key:s._id,class:"postArea my-3 p-4"},[e("div",X,[e("div",Y,[e("img",{src:s.user.photo,alt:"userPhoto"},null,8,Z)]),e("div",ee,[A(w,{to:"/community/postArea/"+s.user._id},{default:T(()=>[e("p",te,[e("span",null,c(s.user.name),1)])]),_:2},1032,["to"]),e("div",se,c(s.createdAt.split(/(T|\.)/)[0])+"  "+c(s.createdAt.split(/(T|\.)/)[2]),1)])]),e("div",oe,c(s.content),1),s.image?(r(),n("div",ie,[e("img",{src:s.image,alt:"postImg"},null,8,ne)])):x("",!0),e("div",re,[e("div",{class:"likeBtn",ref_for:!0,ref:"like",onClick:a=>h.likeSubmit(s,i.currentUserData._id)},[h.isLikeHaveMe(s,i.currentUserData._id)?(r(),n("i",le)):(r(),n("i",ce))],8,ae),h.isLikeHaveMe(s,i.currentUserData._id)&&s.likes.length===1?(r(),n("div",de," 您已按讚")):s.likes.length===0?(r(),n("div",me," 尚未有人按讚")):h.isLikeHaveMe(s,i.currentUserData._id)&&s.likes.length>1?(r(),n("div",he," 您與其他 "+c(s.likes.length-1)+" 位按讚",1)):(r(),n("div",ue,c(s.likes.length)+" 位按讚",1))]),e("div",_e,[e("div",pe,[e("img",{src:i.currentUserData.photo,alt:"userPhoto"},null,8,ke)]),e("div",ve,[e("input",{type:"text",class:"form-control h-100",placeholder:"留言...",ref_for:!0,ref:"comment"},null,512),e("button",{class:"btn btn-secondary MetaWall_button px-5",type:"button",onClick:a=>h.commentSubmit(s,M)},"留言",8,ge)])]),(r(!0),n(p,null,C(s.comments,a=>{var g,f;return r(),n("div",{key:a._id},[e("div",fe,[e("div",ye,[e("div",be,[e("img",{class:"img-fluid",src:(g=a==null?void 0:a.user)==null?void 0:g.photo,alt:"userPhoto"},null,8,xe)]),e("div",Ce,[K(c((f=a==null?void 0:a.user)==null?void 0:f.name),1),Pe,e("div",Se,c(a.createdAt.split(/(T|\.)/)[0])+"  "+c(a.createdAt.split(/(T|\.)/)[2]),1)])]),e("div",we,c(a.content),1)])])}),128))]))),128))],64)}const Oe=D(H,[["render",Me],["__scopeId","data-v-74c4284d"]]);export{Oe as default};
